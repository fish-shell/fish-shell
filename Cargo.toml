[workspace]
resolver = "2"
members = [
    "fish-rust/widestring-suffix",
]

[workspace.package]
rust-version = "1.67"
edition = "2021"

# TODO: Move fish-rust to src, make it the root package of this workspace

[profile.release]
overflow-checks = true

[package]
name = "fish"
version = "0.1.0"
edition.workspace = true
rust-version.workspace = true
build = "fish-rust/build.rs"

[dependencies]
widestring-suffix = { path = "fish-rust/widestring-suffix/" }
pcre2 = { git = "https://github.com/fish-shell/rust-pcre2", branch = "master", default-features = false, features = ["utf32"] }
fast-float = { git = "https://github.com/fish-shell/fast-float-rust", branch="fish" }
hexponent = { git = "https://github.com/fish-shell/hexponent", branch="fish" }
printf-compat = { git = "https://github.com/fish-shell/printf-compat.git", branch="fish" }

bitflags = "2.4.0"
errno = "0.2.8"
lazy_static = "1.4.0"
libc = "0.2.137"
lru = "0.10.0"
nix = { version = "0.25.0", default-features = false, features = ["inotify", "resource"] }
num-traits = "0.2.15"
# to make integer->enum conversion easier
num-derive = "0.3.3"
once_cell = "1.17.0"
rand = { version = "0.8.5", features = ["small_rng"] }
widestring = "1.0.2"
git-version = "0.3"

[dev-dependencies]
rand_pcg = "0.3.1"
serial_test = "0.4.0"

[build-dependencies]
cc = "1.0.83"
rsconf = "0.1.1"

[lib]
crate-type = ["rlib"]
path = "fish-rust/src/lib.rs"
doctest = false

[[bin]]
name = "fish"
path = "fish-rust/src/bin/fish.rs"

[[bin]]
name = "fish_indent"
path = "fish-rust/src/bin/fish_indent.rs"

[[bin]]
name = "fish_key_reader"
path = "fish-rust/src/bin/fish_key_reader.rs"

[features]
default = []
benchmark = []

# The following features are auto-detected by the build-script and should not be enabled manually.
asan = []
bsd = []

[lints]
rust.non_camel_case_types = "allow"
rust.dead_code = "allow"
rust.non_upper_case_globals = "allow"
rust.unstable_name_collisions = "allow"
clippy.bool_assert_comparison = "allow"
clippy.box_default = "allow"
clippy.collapsible_if = "allow"
clippy.comparison_chain = "allow"
clippy.derivable_impls = "allow"
clippy.field_reassign_with_default = "allow"
clippy.get_first = "allow"
clippy.if_same_then_else = "allow"
clippy.len_without_is_empty = "allow"
clippy.manual_is_ascii_check = "allow"
clippy.mut_from_ref = "allow"
clippy.needless_return = "allow"
clippy.new_without_default = "allow"
clippy.option_map_unit_fn = "allow"
clippy.ptr_arg = "allow"
clippy.redundant_slicing = "allow"
clippy.too_many_arguments = "allow"
clippy.uninlined_format_args = "allow"
clippy.unnecessary_to_owned = "allow"
clippy.unnecessary_unwrap = "allow"
