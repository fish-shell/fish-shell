# vim: set filetype=expect:
#
# Verify `$pipestatus` is preserved to next prompt.

spawn $fish

expect_prompt

send_line "true"
expect_prompt
send_line "echo \$pipestatus : \$status"
expect_prompt "0 : 0" {}

send_line "false | true | false"
expect_prompt
send_line "echo \$pipestatus : \$status"
expect_prompt "1 0 1 : 1" {}

send_line "/usr/bin/true | false | true | true"
expect_prompt
send_line "echo \$pipestatus : \$status"
expect_prompt "0 1 0 0 : 0" {}

send_line "/usr/bin/true | /usr/bin/false | /usr/bin/false"
expect_prompt
send_line "echo \$pipestatus : \$status"
expect_prompt "0 1 1 : 1" {}

send_line "sh -c 'exit 3' | /usr/bin/false | sh -c 'exit 5'"
expect_prompt
send_line "echo \$pipestatus : \$status"
expect_prompt "3 1 5 : 5" {}
